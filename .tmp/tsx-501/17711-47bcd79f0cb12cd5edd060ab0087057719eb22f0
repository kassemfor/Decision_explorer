{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{stronglyConnectedComponents}from\"./scc\";function analyzeGraph(graph,options={}){const outStrength={};const inStrength={};const outCount={};const inCount={};for(const n of graph.nodes){outStrength[n.id]=0;inStrength[n.id]=0;outCount[n.id]=0;inCount[n.id]=0}for(const e of graph.edges){const w=Math.max(0,e.strength??1);outStrength[e.sourceId]=(outStrength[e.sourceId]??0)+w;inStrength[e.targetId]=(inStrength[e.targetId]??0)+w;outCount[e.sourceId]=(outCount[e.sourceId]??0)+1;inCount[e.targetId]=(inCount[e.targetId]??0)+1}const drivers=graph.nodes.map(n=>({nodeId:n.id,score:outStrength[n.id]??0})).sort((a,b)=>b.score-a.score).slice(0,20);const outcomes=graph.nodes.map(n=>({nodeId:n.id,score:inStrength[n.id]??0})).sort((a,b)=>b.score-a.score).slice(0,20);const sccs=stronglyConnectedComponents(graph);const loops=sccs.filter(c=>c.length>1).map(c=>({nodes:c,size:c.length})).sort((a,b)=>b.size-a.size).slice(0,50);const clusters={};if((options.clustering??\"tags\")===\"none\"){for(const n of graph.nodes)clusters[n.id]=\"cluster:all\"}else{for(const n of graph.nodes)clusters[n.id]=`tag:${(n.tags??[])[0]??\"__untagged__\"}`}const headNodes=[];const tailNodes=[];const orphans=[];const nodeReport=graph.nodes.map(n=>{const ic=inCount[n.id]??0;const oc=outCount[n.id]??0;const is_=inStrength[n.id]??0;const os=outStrength[n.id]??0;let role=\"Ordinary\";if(ic===0&&oc===0){role=\"Orphan\";orphans.push(n.id)}else if(oc===0){role=\"Head\";headNodes.push(n.id)}else if(ic===0){role=\"Tail\";tailNodes.push(n.id)}return{nodeId:n.id,inCount:ic,outCount:oc,inStrength:is_,outStrength:os,domain:is_+os,role}}).sort((a,b)=>b.domain-a.domain);const adj={};for(const n of graph.nodes)adj[n.id]=[];for(const e of graph.edges){if(adj[e.sourceId])adj[e.sourceId].push(e.targetId)}const headSet=new Set(headNodes);const potentNodes=[];for(const tailId of tailNodes){const visited=new Set;const queue=[tailId];visited.add(tailId);const reachedHeads=new Set;while(queue.length>0){const curr=queue.shift();if(headSet.has(curr)&&curr!==tailId)reachedHeads.add(curr);for(const next of adj[curr]??[]){if(!visited.has(next)){visited.add(next);queue.push(next)}}}if(reachedHeads.size>=2)potentNodes.push(tailId)}return{scores:{outStrength,inStrength},drivers,outcomes,clusters,loops,nodeReport,headNodes,tailNodes,orphans,potentNodes}}__name(analyzeGraph,\"analyzeGraph\");export{analyzeGraph};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/admin/Decision_explorer/packages/graph-core/src/analyze.ts"],"sourcesContent":[null]}}